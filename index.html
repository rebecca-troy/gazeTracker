function onResults(results) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  debug.textContent = "Tracking face...";

  if (results.multiFaceLandmarks && results.multiFaceLandmarks.length > 0) {
    const landmarks = results.multiFaceLandmarks[0];

    for (const point of landmarks) {
      drawLandmark(point);
    }

    // Calculate left iris center
    const leftIris = averageLandmarks(landmarks.slice(473, 478));
    const irisX = leftIris.x * window.innerWidth;
    const irisY = leftIris.y * window.innerHeight;

    // Move the gaze dot to the iris center
    gazeDot.style.left = `${irisX}px`;
    gazeDot.style.top = `${irisY}px`;
  } else {
    debug.textContent = "Face not detected.";
  }
}

// Utility function to average landmark positions
function averageLandmarks(landmarks) {
  const sum = landmarks.reduce((acc, point) => {
    return {
      x: acc.x + point.x,
      y: acc.y + point.y,
      z: acc.z + point.z
    };
  }, { x: 0, y: 0, z: 0 });

  const count = landmarks.length;
  return {
    x: sum.x / count,
    y: sum.y / count,
    z: sum.z / count
  };
}
